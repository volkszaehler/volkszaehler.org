// Source: https://github.com/kvz/locutus/blob/master/src/php/datetime/strtotime.js with removed module.exports in L1028
const reSpace="[ \\t]+",reSpaceOpt="[ \\t]*",reMeridian="(?:([ap])\\.?m\\.?([\\t ]|$))",reHour24="(2[0-4]|[01]?[0-9])",reHour24lz="([01][0-9]|2[0-4])",reHour12="(0?[1-9]|1[0-2])",reMinute="([0-5]?[0-9])",reMinutelz="([0-5][0-9])",reSecond="(60|[0-5]?[0-9])",reSecondlz="(60|[0-5][0-9])",reFrac="(?:\\.([0-9]+))",reDayfull="sunday|monday|tuesday|wednesday|thursday|friday|saturday",reDayabbr="sun|mon|tue|wed|thu|fri|sat",reDaytext=reDayfull+"|"+reDayabbr+"|weekdays?",reReltextnumber="first|second|third|fourth|fifth|sixth|seventh|eighth?|ninth|tenth|eleventh|twelfth",reReltexttext="next|last|previous|this",reReltextunit="(?:second|sec|minute|min|hour|day|fortnight|forthnight|month|year)s?|weeks|"+reDaytext,reYear="([0-9]{1,4})",reYear2="([0-9]{2})",reYear4="([0-9]{4})",reYear4withSign="([+-]?[0-9]{4})",reMonth="(1[0-2]|0?[0-9])",reMonthlz="(0[0-9]|1[0-2])",reDay="(?:(3[01]|[0-2]?[0-9])(?:st|nd|rd|th)?)",reDaylz="(0[0-9]|[1-2][0-9]|3[01])",reMonthFull="january|february|march|april|may|june|july|august|september|october|november|december",reMonthAbbr="jan|feb|mar|apr|may|jun|jul|aug|sept?|oct|nov|dec",reMonthroman="i[vx]|vi{0,3}|xi{0,2}|i{1,3}",reMonthText="("+reMonthFull+"|"+reMonthAbbr+"|"+reMonthroman+")",reTzCorrection="((?:GMT)?([+-])"+reHour24+":?"+reMinute+"?)",reDayOfYear="(00[1-9]|0[1-9][0-9]|[12][0-9][0-9]|3[0-5][0-9]|36[0-6])",reWeekOfYear="(0[1-9]|[1-4][0-9]|5[0-3])";function processMeridian(e,t){switch(t=t&&t.toLowerCase()){case"a":e+=12===e?-12:0;break;case"p":e+=12!==e?12:0}return e}function processYear(e){let t=+e;return e.length<4&&t<100&&(t+=t<70?2e3:1900),t}function lookupMonth(e){return{jan:0,january:0,i:0,feb:1,february:1,ii:1,mar:2,march:2,iii:2,apr:3,april:3,iv:3,may:4,v:4,jun:5,june:5,vi:5,jul:6,july:6,vii:6,aug:7,august:7,viii:7,sep:8,sept:8,september:8,ix:8,oct:9,october:9,x:9,nov:10,november:10,xi:10,dec:11,december:11,xii:11}[e.toLowerCase()]}function lookupWeekday(e,t=0){return{mon:1,monday:1,tue:2,tuesday:2,wed:3,wednesday:3,thu:4,thursday:4,fri:5,friday:5,sat:6,saturday:6,sun:0,sunday:0}[e.toLowerCase()]||t}function lookupRelative(e){const t=e.toLowerCase();return{amount:{last:-1,previous:-1,this:0,first:1,next:1,second:2,third:3,fourth:4,fifth:5,sixth:6,seventh:7,eight:8,eighth:8,ninth:9,tenth:10,eleventh:11,twelfth:12}[t],behavior:{this:1}[t]||0}}function processTzCorrection(e,t){if(!(e=e&&e.match(/(?:GMT)?([+-])(\d+)(:?)(\d{0,2})/i)))return t;let r="-"===e[1]?1:-1,a=+e[2],s=+e[4];return e[4]||e[3]||(s=Math.floor(a%100),a=Math.floor(a/100)),r*(60*a+s)}const formats={yesterday:{regex:/^yesterday/i,name:"yesterday",callback(){return this.rd-=1,this.resetTime()}},now:{regex:/^now/i,name:"now"},noon:{regex:/^noon/i,name:"noon",callback(){return this.resetTime()&&this.time(12,0,0,0)}},midnightOrToday:{regex:/^(midnight|today)/i,name:"midnight | today",callback(){return this.resetTime()}},tomorrow:{regex:/^tomorrow/i,name:"tomorrow",callback(){return this.rd+=1,this.resetTime()}},timestamp:{regex:/^@(-?\d+)/i,name:"timestamp",callback(e,t){return this.rs+=+t,this.y=1970,this.m=0,this.d=1,this.dates=0,this.resetTime()&&this.zone(0)}},firstOrLastDay:{regex:/^(first|last) day of/i,name:"firstdayof | lastdayof",callback(e,t){"first"===t.toLowerCase()?this.firstOrLastDayOfMonth=1:this.firstOrLastDayOfMonth=-1}},backOrFrontOf:{regex:RegExp("^(back|front) of "+reHour24+"[ \\t]*"+reMeridian+"?","i"),name:"backof | frontof",callback(e,t,r,a){let s=+r,i=15;return"back"===t.toLowerCase()||(s-=1,i=45),s=processMeridian(s,a),this.resetTime()&&this.time(s,i,0,0)}},weekdayOf:{regex:RegExp("^("+reReltextnumber+"|"+reReltexttext+")"+reSpace+"("+reDayfull+"|"+reDayabbr+")"+reSpace+"of","i"),name:"weekdayof"},mssqltime:{regex:RegExp("^"+reHour12+":"+reMinutelz+":"+reSecondlz+"[:.]([0-9]+)"+reMeridian,"i"),name:"mssqltime",callback(e,t,r,a,s,i){return this.time(processMeridian(+t,i),+r,+a,+s.substr(0,3))}},timeLong12:{regex:RegExp("^"+reHour12+"[:.]"+reMinute+"[:.]"+reSecondlz+"[ \\t]*"+reMeridian,"i"),name:"timelong12",callback(e,t,r,a,s){return this.time(processMeridian(+t,s),+r,+a,0)}},timeShort12:{regex:RegExp("^"+reHour12+"[:.]"+reMinutelz+"[ \\t]*"+reMeridian,"i"),name:"timeshort12",callback(e,t,r,a){return this.time(processMeridian(+t,a),+r,0,0)}},timeTiny12:{regex:RegExp("^"+reHour12+"[ \\t]*"+reMeridian,"i"),name:"timetiny12",callback(e,t,r){return this.time(processMeridian(+t,r),0,0,0)}},soap:{regex:RegExp("^([0-9]{4})-"+reMonthlz+"-"+reDaylz+"T"+reHour24lz+":"+reMinutelz+":"+reSecondlz+reFrac+reTzCorrection+"?","i"),name:"soap",callback(e,t,r,a,s,i,o,n,h){return this.ymd(+t,r-1,+a)&&this.time(+s,+i,+o,+n.substr(0,3))&&this.zone(processTzCorrection(h))}},wddx:{regex:RegExp("^([0-9]{4})-"+reMonth+"-"+reDay+"T"+reHour24+":"+reMinute+":"+reSecond),name:"wddx",callback(e,t,r,a,s,i,o){return this.ymd(+t,r-1,+a)&&this.time(+s,+i,+o,0)}},exif:{regex:RegExp("^([0-9]{4}):"+reMonthlz+":"+reDaylz+" "+reHour24lz+":"+reMinutelz+":"+reSecondlz,"i"),name:"exif",callback(e,t,r,a,s,i,o){return this.ymd(+t,r-1,+a)&&this.time(+s,+i,+o,0)}},xmlRpc:{regex:RegExp("^"+reYear4+reMonthlz+reDaylz+"T"+reHour24+":"+reMinutelz+":"+reSecondlz),name:"xmlrpc",callback(e,t,r,a,s,i,o){return this.ymd(+t,r-1,+a)&&this.time(+s,+i,+o,0)}},xmlRpcNoColon:{regex:RegExp("^"+reYear4+reMonthlz+reDaylz+"[Tt]"+reHour24+reMinutelz+reSecondlz),name:"xmlrpcnocolon",callback(e,t,r,a,s,i,o){return this.ymd(+t,r-1,+a)&&this.time(+s,+i,+o,0)}},clf:{regex:RegExp("^"+reDay+"/("+reMonthAbbr+")/"+reYear4+":"+reHour24lz+":"+reMinutelz+":"+reSecondlz+reSpace+reTzCorrection,"i"),name:"clf",callback(e,t,r,a,s,i,o,n){return this.ymd(+a,lookupMonth(r),+t)&&this.time(+s,+i,+o,0)&&this.zone(processTzCorrection(n))}},iso8601long:{regex:RegExp("^t?"+reHour24+"[:.]"+reMinute+"[:.]"+reSecond+reFrac,"i"),name:"iso8601long",callback(e,t,r,a,s){return this.time(+t,+r,+a,+s.substr(0,3))}},dateTextual:{regex:RegExp("^"+reMonthText+"[ .\\t-]*"+reDay+"[,.stndrh\\t ]+"+reYear,"i"),name:"datetextual",callback(e,t,r,a){return this.ymd(processYear(a),lookupMonth(t),+r)}},pointedDate4:{regex:RegExp("^"+reDay+"[.\\t-]"+reMonth+"[.-]"+reYear4),name:"pointeddate4",callback(e,t,r,a){return this.ymd(+a,r-1,+t)}},pointedDate2:{regex:RegExp("^"+reDay+"[.\\t]"+reMonth+"\\."+reYear2),name:"pointeddate2",callback(e,t,r,a){return this.ymd(processYear(a),r-1,+t)}},timeLong24:{regex:RegExp("^t?"+reHour24+"[:.]"+reMinute+"[:.]"+reSecond),name:"timelong24",callback(e,t,r,a){return this.time(+t,+r,+a,0)}},dateNoColon:{regex:RegExp("^"+reYear4+reMonthlz+reDaylz),name:"datenocolon",callback(e,t,r,a){return this.ymd(+t,r-1,+a)}},pgydotd:{regex:RegExp("^([0-9]{4})\\.?"+reDayOfYear),name:"pgydotd",callback(e,t,r){return this.ymd(+t,0,+r)}},timeShort24:{regex:RegExp("^t?"+reHour24+"[:.]"+reMinute,"i"),name:"timeshort24",callback(e,t,r){return this.time(+t,+r,0,0)}},iso8601noColon:{regex:RegExp("^t?"+reHour24lz+reMinutelz+reSecondlz,"i"),name:"iso8601nocolon",callback(e,t,r,a){return this.time(+t,+r,+a,0)}},iso8601dateSlash:{regex:RegExp("^([0-9]{4})/"+reMonthlz+"/"+reDaylz+"/"),name:"iso8601dateslash",callback(e,t,r,a){return this.ymd(+t,r-1,+a)}},dateSlash:{regex:RegExp("^([0-9]{4})/"+reMonth+"/"+reDay),name:"dateslash",callback(e,t,r,a){return this.ymd(+t,r-1,+a)}},american:{regex:RegExp("^"+reMonth+"/"+reDay+"/"+reYear),name:"american",callback(e,t,r,a){return this.ymd(processYear(a),t-1,+r)}},americanShort:{regex:RegExp("^"+reMonth+"/"+reDay),name:"americanshort",callback(e,t,r){return this.ymd(this.y,t-1,+r)}},gnuDateShortOrIso8601date2:{regex:RegExp("^"+reYear+"-"+reMonth+"-"+reDay),name:"gnudateshort | iso8601date2",callback(e,t,r,a){return this.ymd(processYear(t),r-1,+a)}},iso8601date4:{regex:RegExp("^([+-]?[0-9]{4})-"+reMonthlz+"-"+reDaylz),name:"iso8601date4",callback(e,t,r,a){return this.ymd(+t,r-1,+a)}},gnuNoColon:{regex:RegExp("^t"+reHour24lz+reMinutelz,"i"),name:"gnunocolon",callback(e,t,r){return this.time(+t,+r,0,this.f)}},gnuDateShorter:{regex:RegExp("^([0-9]{4})-"+reMonth),name:"gnudateshorter",callback(e,t,r){return this.ymd(+t,r-1,1)}},pgTextReverse:{regex:RegExp("^(\\d{3,4}|[4-9]\\d|3[2-9])-("+reMonthAbbr+")-"+reDaylz,"i"),name:"pgtextreverse",callback(e,t,r,a){return this.ymd(processYear(t),lookupMonth(r),+a)}},dateFull:{regex:RegExp("^"+reDay+"[ \\t.-]*"+reMonthText+"[ \\t.-]*"+reYear,"i"),name:"datefull",callback(e,t,r,a){return this.ymd(processYear(a),lookupMonth(r),+t)}},dateNoDay:{regex:RegExp("^"+reMonthText+"[ .\\t-]*"+reYear4,"i"),name:"datenoday",callback(e,t,r){return this.ymd(+r,lookupMonth(t),1)}},dateNoDayRev:{regex:RegExp("^([0-9]{4})[ .\\t-]*"+reMonthText,"i"),name:"datenodayrev",callback(e,t,r){return this.ymd(+t,lookupMonth(r),1)}},pgTextShort:{regex:RegExp("^("+reMonthAbbr+")-"+reDaylz+"-"+reYear,"i"),name:"pgtextshort",callback(e,t,r,a){return this.ymd(processYear(a),lookupMonth(t),+r)}},dateNoYear:{regex:RegExp("^"+reMonthText+"[ .\\t-]*"+reDay+"[,.stndrh\\t ]*","i"),name:"datenoyear",callback(e,t,r){return this.ymd(this.y,lookupMonth(t),+r)}},dateNoYearRev:{regex:RegExp("^"+reDay+"[ .\\t-]*"+reMonthText,"i"),name:"datenoyearrev",callback(e,t,r){return this.ymd(this.y,lookupMonth(r),+t)}},isoWeekDay:{regex:RegExp("^([0-9]{4})-?W"+reWeekOfYear+"(?:-?([0-7]))?"),name:"isoweekday | isoweek",callback(e,t,r,a){if(a=a?+a:1,!this.ymd(+t,0,1))return!1;let s=new Date(this.y,this.m,this.d).getDay();s=0-(s>4?s-7:s),this.rd+=s+7*(r-1)+a}},relativeText:{regex:RegExp("^("+reReltextnumber+"|"+reReltexttext+")"+reSpace+"("+reReltextunit+")","i"),name:"relativetext",callback(e,t,r){const{amount:a,behavior:s}=lookupRelative(t);switch(r.toLowerCase()){case"sec":case"secs":case"second":case"seconds":this.rs+=a;break;case"min":case"mins":case"minute":case"minutes":this.ri+=a;break;case"hour":case"hours":this.rh+=a;break;case"day":case"days":this.rd+=a;break;case"fortnight":case"fortnights":case"forthnight":case"forthnights":this.rd+=14*a;break;case"week":case"weeks":this.rd+=7*a;break;case"month":case"months":this.rm+=a;break;case"year":case"years":this.ry+=a;break;case"mon":case"monday":case"tue":case"tuesday":case"wed":case"wednesday":case"thu":case"thursday":case"fri":case"friday":case"sat":case"saturday":case"sun":case"sunday":this.resetTime(),this.weekday=lookupWeekday(r,7),this.weekdayBehavior=1,this.rd+=7*(a>0?a-1:a)}}},relative:{regex:RegExp("^([+-]*)[ \\t]*(\\d+)[ \\t]*("+reReltextunit+"|week)","i"),name:"relative",callback(e,t,r,a){const s=t.replace(/[^-]/g,"").length;let i=+r*Math.pow(-1,s);switch(a.toLowerCase()){case"sec":case"secs":case"second":case"seconds":this.rs+=i;break;case"min":case"mins":case"minute":case"minutes":this.ri+=i;break;case"hour":case"hours":this.rh+=i;break;case"day":case"days":this.rd+=i;break;case"fortnight":case"fortnights":case"forthnight":case"forthnights":this.rd+=14*i;break;case"week":case"weeks":this.rd+=7*i;break;case"month":case"months":this.rm+=i;break;case"year":case"years":this.ry+=i;break;case"mon":case"monday":case"tue":case"tuesday":case"wed":case"wednesday":case"thu":case"thursday":case"fri":case"friday":case"sat":case"saturday":case"sun":case"sunday":this.resetTime(),this.weekday=lookupWeekday(a,7),this.weekdayBehavior=1,this.rd+=7*(i>0?i-1:i)}}},dayText:{regex:RegExp("^("+reDaytext+")","i"),name:"daytext",callback(e,t){this.resetTime(),this.weekday=lookupWeekday(t,0),2!==this.weekdayBehavior&&(this.weekdayBehavior=1)}},relativeTextWeek:{regex:RegExp("^("+reReltexttext+")"+reSpace+"week","i"),name:"relativetextweek",callback(e,t){switch(this.weekdayBehavior=2,t.toLowerCase()){case"this":this.rd+=0;break;case"next":this.rd+=7;break;case"last":case"previous":this.rd-=7}isNaN(this.weekday)&&(this.weekday=1)}},monthFullOrMonthAbbr:{regex:RegExp("^("+reMonthFull+"|"+reMonthAbbr+")","i"),name:"monthfull | monthabbr",callback(e,t){return this.ymd(this.y,lookupMonth(t),this.d)}},tzCorrection:{regex:RegExp("^"+reTzCorrection,"i"),name:"tzcorrection",callback(e){return this.zone(processTzCorrection(e))}},ago:{regex:/^ago/i,name:"ago",callback(){this.ry=-this.ry,this.rm=-this.rm,this.rd=-this.rd,this.rh=-this.rh,this.ri=-this.ri,this.rs=-this.rs,this.rf=-this.rf}},gnuNoColon2:{regex:RegExp("^"+reHour24lz+reMinutelz,"i"),name:"gnunocolon",callback(e,t,r){return this.time(+t,+r,0,this.f)}},year4:{regex:RegExp("^"+reYear4),name:"year4",callback(e,t){return this.y=+t,!0}},whitespace:{regex:/^[ .,\t]+/,name:"whitespace"},any:{regex:/^[\s\S]+/,name:"any",callback:()=>!1}};let resultProto={y:NaN,m:NaN,d:NaN,h:NaN,i:NaN,s:NaN,f:NaN,ry:0,rm:0,rd:0,rh:0,ri:0,rs:0,rf:0,weekday:NaN,weekdayBehavior:0,firstOrLastDayOfMonth:0,z:NaN,dates:0,times:0,zones:0,ymd(e,t,r){return!(this.dates>0)&&(this.dates++,this.y=e,this.m=t,this.d=r,!0)},time(e,t,r,a){return!(this.times>0)&&(this.times++,this.h=e,this.i=t,this.s=r,this.f=a,!0)},resetTime(){return this.h=0,this.i=0,this.s=0,this.f=0,this.times=0,!0},zone(e){return this.zones<=1&&(this.zones++,this.z=e,!0)},toDate(e){switch(this.dates&&!this.times&&(this.h=this.i=this.s=this.f=0),isNaN(this.y)&&(this.y=e.getFullYear()),isNaN(this.m)&&(this.m=e.getMonth()),isNaN(this.d)&&(this.d=e.getDate()),isNaN(this.h)&&(this.h=e.getHours()),isNaN(this.i)&&(this.i=e.getMinutes()),isNaN(this.s)&&(this.s=e.getSeconds()),isNaN(this.f)&&(this.f=e.getMilliseconds()),this.firstOrLastDayOfMonth){case 1:this.d=1;break;case-1:this.d=0,this.m+=1}if(!isNaN(this.weekday)){var t=new Date(e.getTime());t.setFullYear(this.y,this.m,this.d),t.setHours(this.h,this.i,this.s,this.f);var r=t.getDay();if(2===this.weekdayBehavior)0===r&&0!==this.weekday&&(this.weekday=-6),0===this.weekday&&0!==r&&(this.weekday=7),this.d-=r,this.d+=this.weekday;else{var a=this.weekday-r;(this.rd<0&&a<0||this.rd>=0&&a<=-this.weekdayBehavior)&&(a+=7),this.weekday>=0?this.d+=a:this.d-=7-(Math.abs(this.weekday)-r),this.weekday=NaN}}this.y+=this.ry,this.m+=this.rm,this.d+=this.rd,this.h+=this.rh,this.i+=this.ri,this.s+=this.rs,this.f+=this.rf,this.ry=this.rm=this.rd=0,this.rh=this.ri=this.rs=this.rf=0;let s=new Date(e.getTime());switch(s.setFullYear(this.y,this.m,this.d),s.setHours(this.h,this.i,this.s,this.f),this.firstOrLastDayOfMonth){case 1:s.setDate(1);break;case-1:s.setMonth(s.getMonth()+1,0)}return isNaN(this.z)||s.getTimezoneOffset()===this.z||(s.setUTCFullYear(s.getFullYear(),s.getMonth(),s.getDate()),s.setUTCHours(s.getHours(),s.getMinutes()+this.z,s.getSeconds(),s.getMilliseconds())),s}};function strtotime(e,t){null==t&&(t=Math.floor(Date.now()/1e3));const r=[formats.yesterday,formats.now,formats.noon,formats.midnightOrToday,formats.tomorrow,formats.timestamp,formats.firstOrLastDay,formats.backOrFrontOf,formats.mssqltime,formats.timeLong12,formats.timeShort12,formats.timeTiny12,formats.soap,formats.wddx,formats.exif,formats.xmlRpc,formats.xmlRpcNoColon,formats.clf,formats.iso8601long,formats.dateTextual,formats.pointedDate4,formats.pointedDate2,formats.timeLong24,formats.dateNoColon,formats.pgydotd,formats.timeShort24,formats.iso8601noColon,formats.iso8601dateSlash,formats.dateSlash,formats.american,formats.americanShort,formats.gnuDateShortOrIso8601date2,formats.iso8601date4,formats.gnuNoColon,formats.gnuDateShorter,formats.pgTextReverse,formats.dateFull,formats.dateNoDay,formats.dateNoDayRev,formats.pgTextShort,formats.dateNoYear,formats.dateNoYearRev,formats.isoWeekDay,formats.relativeText,formats.relative,formats.dayText,formats.relativeTextWeek,formats.monthFullOrMonthAbbr,formats.tzCorrection,formats.ago,formats.gnuNoColon2,formats.year4,formats.whitespace,formats.any];let a=Object.create(resultProto);for(;e.length;)for(let t=0,s=r.length;t<s;t++){const s=r[t],i=e.match(s.regex);if(i){if(s.callback&&!1===s.callback.apply(a,i))return!1;e=e.substr(i[0].length);break}}return Math.floor(a.toDate(new Date(1e3*t))/1e3)}
